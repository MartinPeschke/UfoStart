<%inherit file="../../layout.html"/>
<%namespace file="hnc:forms/templates/baseform.html" name="baseform"/>
<%namespace file="../../widgets.html" name="widgets"/>

<%def name="header_buttons()">
    <div class="pull-right">
        Company: <a href="${url('website_company', **vctxt.urlArgs)}">${vctxt.company.name}</a>
    </div>
</%def>


<%def name="content()">
    <div class="container">
        <div class="row">
            <div class="col col-lg-12">
                <h1 class="site-slogan">
                    ${vctxt.need.name}
                </h1>

                <p>${html.nn(vctxt.need.summary)}</p>
            </div>
        </div>
    </div>
        <div class="container">
            <div class="row mar-top-1">
                <div class="col col-lg-8">
                %if vctxt.isTeamMember:
                    ${self.bodyContent(vctxt.need)}
                %else:
                    <div class="box-title">${vctxt.need.name}</div>
                    ${self.needDetails(vctxt.need)}
                %endif
                </div>
                <div class="col col-lg-4">
                    %if vctxt.isTeamMember:
                        ${self.privateInfoBox(vctxt.company, vctxt.need)}
                    %else:
                        ${self.publicInfoBox(vctxt.company, vctxt.need)}
                    %endif
                    ${self.endorsementBox(vctxt.company, vctxt.need)}
                </div>
            </div>
        </div>
    <div class="container">
        <div class="row mar-top-2">
            <div class="col col-lg 12">
                <div class="box-title">Applications</div>
                ${self.applications(vctxt.need.Applications)}
            </div>
        </div>
    </div>
</%def>

<%def name="bodyContent(need)">
    <div class="box-framed">
        <div class="box-title"><a href="${url("website_round_need_edit", **vctxt.urlArgs)}" class="btn btn-primary">Edit</a>Need Details</div>
        <div class="box-content">${self.needDetails(need)}</div>
    </div>
</%def>

<%def name="needDetails(need)">
    <div class="description mar-top-1">
        %if need.picture:
            <div class="picture need empty">
                <img src="${need.picture}"/>
            </div>
        %endif
        ${widgets.valuation(need)}

        <div>
            ${html.nn(vctxt.need.customText)}
        </div>
    </div>
    <h5 class="text-muted">
        Related Tags
    </h5>
    <div class="label-list">
        %for tag in need.tags:
            <span class="label label-info spaced text-small">${tag}</span>
        %endfor
    </div>
</%def>

<%def name="endorsementBox(company, need)">
    <div class="box-framed endorsements">
    <div class="box-title">Endorsed Experts</div>
    <script type="text/template" class="endorsement-template">
        <div class="row single-candidate search-result-item" data-entity-id="{{ model.id }}">
            <div class="col col-sm-3">
                <div class="picture">
                    <img src="{{ model.getPicture() }}"/>
                </div>
            </div>
            <div class="col col-sm-9">
                <strong>{{ model.getName() }}</strong>
                <p class="text-small">{{ model.getPosition() }}</p>
            </div>
        </div>
    </script>
    <div class="box-content"></div>
    </div>
    %if vctxt.user.isAnon():
        <div class="box-framed">
            <div class="box-title">Login to endorse</div>
            <div class="box-content text-center">
                ${widgets.login_btn('linkedin')}
            </div>
        </div>
    %else:
        <div class="box-framed">
            <div class="box-title">Endorse your contacts for this need</div>
            <div class="box-content">
                <div class="linkedin-widget" data-widget="LinkedContactSearch">
                    <script type="text/template" class="contact-template">
                        <div class="row single-candidate search-result-item" data-entity-id="{{ model.id }}">
                            <div class="col col-sm-3">
                                <div class="picture">
                                    <img src="{{ model.getPicture() }}"/>
                                </div>
                            </div>
                            <div class="col col-sm-9">
                                <a class="pull-right btn btn-small btn-primary">Endorse</a>
                                <strong>{{ model.getName() }}</strong>
                                <p class="text-small">{{ model.getPosition() }}</p>
                            </div>
                        </div>
                    </script>
                    <div class="search-field">
                        <input type="text" class="query" placeholder="Find a contact by name">
                    </div>
                    <div class="results endorsement-search"></div>
                </div>
            </div>
    %endif
</%def>

<%def name="privateInfoBox(company, need)">
<div class="box-framed">
<div class="box-title">Suggested Solutions</div>
<div class="box-content">
    %if need.experts:
        <div class="experts">
            <h5 class="text-muted no-margin upper">Recommended Experts</h5>
            <div class="expert-list">
            %for expert in need.experts:
            <div class="expert-briefing">
                <div class="row">
                    <div class="col col-lg-3">
                        <div class="picture medium">
                            <img src="${expert.picture_url}" alt="${expert.name}"/>
                        </div>
                    </div>
                    <div class="col col-lg-7">
                        <a href="#" class="overflow"><strong>${expert.name}</strong></a>
                        <p class="text-muted text-small">${html.nn(expert.position)}</p>
                    </div>
                    <div class="col col-lg-2">
                        <a class="expander btn btn-default btn-large btn-block" data-toggle-target=".expert-briefing" data-toggle-class="expanded" data-toggle-text="▼">◀</a>
                    </div>
                </div>
                <div class="expert-details row show-expanded">
                    <div class="col col-lg-12">
                        %if expert.introducers:
                            <h6 class="text-muted">Introducers</h6>
                            %for intro in expert.introducers:
                            <div class="row mar-top-half">
                                <div class="col col-sm-2">
                                    <div class="picture mini">
                                        <img src="${intro.picture}" alt="${intro.name}"/>
                                    </div>
                                </div>
                                <div class="col col-sm-4">
                                    <a class="overflow" href="#"><strong>${intro.name}</strong></a>
                                    <p class="text-muted text-small">${intro.position}</p>
                                </div>
                                <div class="col col-lg-6">
                                    <a href="#" class="btn btn-primary btn-small btn-block ">Get Introduction</a>
                                </div>
                            </div>
                            %endfor
                        %endif
                    </div>
                </div>
                </div>
            %endfor
            </div>
        </div>
    %endif
    <h5 class="text-muted no-margin upper mar-top-2">Recommended Cloud Services</h5>
    <div class="service-list row">
    %for service in need.services:
        <div class="col col-lg-4 service-briefing">
            <div class="picture medium">
                <img src="${service.logo_url}" name="${service.name}"/>
            </div>
            <a href="${service.url or '#'}" class="overflow"><strong>${service.name}</strong></a>
            <p class="text-muted text-small">${service.description | html.trunc(50)}</p>
            <a href="${service.url or '#'}" target="_blank" class="btn btn-small btn-block btn-primary">See Details</a>
        </div>
    %endfor
    </div>
</div>
</div>
</%def>



<%def name="publicInfoBox(company, need)">
    <div class="box-framed">
        <div class="box-title">
            Info
        </div>
        <div class="box-content">
            <h5 class="upper text-muted">
                Company
            </h5>
            <div class="row">
                <div class="col col-lg-3">
                    ${widgets.company_logo(company)}
                </div>
                <div class="col col-lg-6">
                    <strong><a href="${url("website_company", **vctxt.urlArgs)}" class="overflow">${company.display_name}</a></strong>
                    <div class="tagline">${company.description | html.trunc(50)}</div>
                </div>
                <div class="col col-lg-3">
                    <h5 class="text-muted no-margin">Team members</h5>
                    <h5 class="no-margin brand-primary">${company.no_users}</h5>
                </div>
            </div>
            <h5 class="upper text-muted">
                Product
            </h5>
            <div class="row">
                <div class="col col-lg-3">
                    ${widgets.product_logo(company)}
                </div>
                <div class="col col-lg-6">
                    %if company.product_is_setup:
                        <a href="${url("website_company_product", **vctxt.urlArgs)}"><strong>${company.product_name}</strong></a>
                        <div class="description">${company.product_description | html.trunc(50) }</div>
                    %else:
                        <strong>Not setup yet</strong>
                    %endif
                </div>
                <div class="col col-lg-3">
                    <h5 class="text-muted no-margin">Pledges</h5>
                    <h5 class="no-margin brand-primary">${company.no_pledgees}</h5>
                </div>
            </div>
        </div>
    </div>
</%def>



<%def name="applications(applications)">
%if applications:
    %for application in sorted(applications, reverse = True):
        <div class="row mar-top-1 single-application" id="applications">
            <div class="col col-lg-12">
            <div class="application">
                <div class="row">
                    <div class="col col-lg-4">
                        <div class="row">
                            <div class="col col-sm-3">
                                <div class="picture">
                                    <a href="${url("website_user", slug = application.User.token)}"><img src="${application.User.picture}"/></a>
                                </div>
                            </div>
                            <div class="col col-sm-9">
                                <a href="${url("website_user", slug = application.User.token)}" class="name"><strong>${application.User.name}</strong></a>
                                <p class="text-small">${html.nn(application.User.position)}</p>
                                <p class="text-small">${application.display_date}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col col-lg-8 control-group">
                        ${application.message}
                    </div>
                </div>
            </div>
            </div>
        </div>
    %endfor
%else:
    <div class="empty">
        No Applications Yet
    </div>
%endif
<div class="text-center">
    <a href="${url("website_round_need_apply", _anchor='application-form', **vctxt.urlArgs)}" class="btn btn-primary mar-top-1">${'Login to Apply' if vctxt.user.isAnon() else 'Apply'}</a>
</div>
</%def>

<%def name="post_scripts()">
    <script>
        require(["views/company/endorse"], function(View){
            new View({el: $(".endorsements"), watch: $(".linkedin-widget")})
        })
    </script>
</%def>
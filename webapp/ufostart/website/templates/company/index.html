<%inherit file="../layout.html"/>
<%namespace file="../widgets.html" name="widgets"/>

<%def name="pageTitle()"><div class="page-header">${vctxt.company.name}</div></%def>

<%def name="content()">
    <div class="container">
        <div class="row mar-top-1">
            <div class="col col-lg-6">
                <div class="box-framed">
                    <div class="box-title">
                        Company
                    </div>
                    <div class="box-content">
                        <div class="row">
                            <div class="col col-lg-2">
                                ${widgets.logo(company.logo_picture)}
                            </div>
                            <div class="col col-lg-6">
                                <a href="${url("website_company_company", **vctxt.urlArgs)}"><strong>${company.name}</strong></a>
                                <div class="tagline">${company.description}</div>
                                <div class="text-muted text-small">
                                    ${company.getDisplayTags()}
                                </div>
                            </div>
                            <div class="col col-lg-4">
                                <h5 class="upper no-margin text-muted">
                                    Team members
                                </h5>
                                <div class="picture-pile">
                                %for member in company.Users[:8]:
                                    <div class="picture mini">
                                        <img src="${member.getPicture()}"/>
                                        %if member.unconfirmed:
                                            <span title="unconfirmed" class="unconfirmed">unconfirmed</span>
                                        %endif
                                    </div>
                                %endfor
                                </div>
                                <a href="${url("website_company_company", **vctxt.urlArgs)}"><small>Invite more team members</small></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-lg-6">
                <div class="box-framed">
                    <div class="box-title">
                        Product
                    </div>
                    <div class="box-content">
                        <div class="row">
                            <div class="col col-lg-3">
                                ${widgets.logo(company.product_picture)}
                            </div>
                            <div class="col col-lg-5">
                                <a href="${url("website_company_product", **vctxt.urlArgs)}"><strong>${company.product_name}</strong></a>
                                <div class="description">${company.product_description}</div>
                                <a href="${url("website_company_product", **vctxt.urlArgs)}"><small>More...</small></a>
                            </div>
                            <div class="col col-lg-4">
                                <h5 class="upper no-margin text-muted">Pledges</h5>
                                <div class="primary-number">${company.no_pledgees}</div>
                                <h5 class="upper no-margin text-muted mar-top-1">Pledgees</h5>
                                <div class="picture-pile">
                                    %for pledge in company.pledgees[:4]:
                                        <div class="picture mini">
                                            <img src="${pledge.picture}"/>
                                        </div>
                                    %endfor
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mar-top-2">
            <div class="col col-lg-12">
                <div class="box-title">
                    Needs
                </div>
            </div>
        </div>
        <div class="row">
            %for i, col in enumerate(company.groupedNeeds(4)):
                <div class="col col-lg-3 need-card-list">
                    %for need in col:
                        ${self.buildNeed(need, company.Round.published)}
                    %endfor
                    %if not i:
                        <a href="${url("website_need_create")}" class="need-card add-card">
                            <img src="${STATIC_URL}img/addneed.png"/>
                            <h5>Create a new Need</h5>
                        </a>
                    %endif
                </div>
            %endfor
        </div>
        <div class="row">
            <div class="col col-lg-3 col-offset-9">
                <a href="#" class="btn btn-primary btn-humonguous btn-block"><span>Publish</span></a>
            </div>
        </div>
    </div>
</%def>


<%def name="buildNeed(need, published)">
    <div class="need-card">
        %if not published:
            %if not need.customized:
                <a class="customize" href="${url("website_need_customize", need=need.key, **vctxt.urlArgs)}">Customize</a>
            %endif
            <a class="remove" data-remove="need-card">Ã—</a>
        %endif
        <h5><a href="${url("website_need_customize", need=need.key, **vctxt.urlArgs)}">${need.name}</a></h5>
        <div class="description">
            ${need.description}
        </div>
        <div class="valuation">
            <div class="primary-number pull-right">
                ${need.equity_mix}%
                <div class="legend">Equity</div>
            </div>
            <div class="primary-number">
                ${need.money_value}
                <div class="legend">Value</div>
            </div>
        </div>
        <div class="label-list">
            %for tag in need.tags:
                <span class="label label-info spaced text-small">${tag}</span>
            %endfor
        </div>
        %if need.Expert:
            <hr/>
            <div class="experts">
                <h5 class="no-margin upper text-muted">Recomended Experts</h5>
                <div class="picture-pile">
                    <div class="picture mini">
                        <img src="${need.Expert.expert_picture}" alt="${need.Expert.expert_name}"/>
                    </div>
                </div>
            </div>
        %endif
        %if need.Service:
            <hr/>
            <div class="services">
                <h5 class="no-margin upper text-muted">Recomended Cloud Services</h5>
                <div class="picture-pile">
                    <div class="picture medium">
                        <img src="${need.Service.logo_picture}" name="${need.Service.name}"/>
                    </div>
                </div>
            </div>
        %endif
    </div>
</%def>



<%def name="buildTaskPillar(round)">
    <%
        taskUrl = url("website_company_round_view" if round.Needs else "website_company_setup_basic", **vctxt.urlArgs)
    %>
    <div class="round-dashboard-group">
        <img src="${STATIC_URL}img/round/tasks.png" />
        <a class="link" href="${taskUrl}">Tasks</a>
    </div>
    <h5 class="text-muted">NEEDS FULFILLED</h5>
    <div class="progress">
        <div style="width:${round.getTaskProgress()}%;" class="progress-bar"></div>
        <span class="progress-num">${round.getTaskProgress()}%</span>
    </div>

    <h6 class="mar-top-2 text-muted">Recent events</h6>
    %if round.getTaskEvent():
        <% event = round.getTaskEvent() %>
        ${self.buildRoundEvent(event, taskUrl)}
    %endif
</%def>


<%def name="buildCustomerPillar(round)">
    <div class="round-dashboard-group">
        <img src="${STATIC_URL}img/round/customers.png" />
        <a class="link" href="${url("website_company_customers", **vctxt.urlArgs)}">Customers</a>
    </div>
    <h5 class="text-muted">PLEDGES</h5>
    <h2>${len(round.Pledges)}</h2>
    <h6 class="mar-top-2 text-muted">Recent pledges</h6>
    %if round.getPledgeEvent():
        <% event = round.getPledgeEvent() %>
        ${self.buildRoundEvent(event, url("website_company_customers", **vctxt.urlArgs))}
    %endif
</%def>


<%def name="buildAssetsPillar(round)">
    <div class="round-dashboard-group">
        <img src="${STATIC_URL}img/round/assets.png" />
        <a class="link" href="#">Assets</a>
    </div>
    <h5 class="text-muted">ASSETS VALUE</h5>
    <h2>0 $</h2>
    <h6 class="mar-top-2 text-muted">Recent events</h6>
    %if round.getAssetsEvent():
        <% event = round.getAssetsEvent() %>
        ${self.buildRoundEvent(event, "#")}
    %endif
</%def>

<%def name="buildMoneyPillar(round)">
    <div class="round-dashboard-group">
        <img src="${STATIC_URL}img/round/money.png" />
        <a class="link" href="#">Money</a>
    </div>
    <h5 class="text-muted">FUNDED</h5>
    <h2>0 $</h2>

    <h6 class="mar-top-2 text-muted">Recent contributions</h6>
    %if round.getMoneyEvent():
        <% event = round.getMoneyEvent() %>
        ${self.buildRoundEvent(event, "#")}
    %endif
</%def>



<%def name="buildRoundEvent(event, moreLink)">
    <div class="round-event">
        <div class="actor-line">
            <img src="${event.picture}" class="img-thumbnail mini"/>
            <a href="#">${event.name}</a>
        </div>
        <div class="action-line">
            ${event.text|n}
        </div>
        <div class="share-line">
            <span class="share-item">${event.recency}</span>
            <a href="#" class="share-item">Like</a>
            <a href="#" class="share-item">Share</a>
        </div>
        <a class="more-line" href="${moreLink}">More...</a>
    </div>
</%def>

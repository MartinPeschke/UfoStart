<%inherit file="../layout.html"/>
<%namespace file="../widgets.html" name="widgets"/>

<%def name="content()">
    <div class="container" id="project-round-need-dashboard">
        <div class="row">
            <div class="col col-lg-12">
                <h1 class="section-title">
                    <span class="brand-primary">${company.display_name} <span class="sub-title">Company Dashboard</span> </span>
                </h1>
            </div>
        </div>
        <div class="row mar-top-1">
            <div class="col col-lg-3 pull-right">
                %if vctxt.canEditCompany:
                    ${self.wtfBox()}
                %endif
            </div>
            <div class="col col-lg-9">
                ${self.upperContent()}
                ${self.lowerContent()}
            </div>
        </div>
    </div>
</%def>

<%def name="upperContent()">
<div class="row">
    <div class="col col-lg-6">
        <div class="box-title highlight-target">
            <div id="target-invite-team" class="highlight-anchor"></div>
            Company
        </div>
        <div class="box-header box-header-muted box-card">
            ${widgets.company_logo(company)}
            <div class="right-box">
                <a href="${url("website_company_company", **vctxt.urlArgs)}" class="overflow"><strong>${company.display_name}</strong></a>
                <div class="description">${html.nn(company.description) | html.trunc(50)}</div>
                <div class="number-widget">
                    <h6>Startup Value</h6>
                    <div class="value">${company.startupValue}</div>
                </div>
            </div>
        </div>
        <div class="mar-top-half">
            <h6>Team members</h6>
            <div class="picture-pile">
            %for user in company.Users[:8]:
                ${widgets.userPic(user, classes='mini')|n}
            %endfor
            %if vctxt.canEditCompany:
                <a href="${url("website_company_company", **vctxt.urlArgs)}"><small>Invite team<br/>members</small></a>
            %endif
            </div>
        </div>
        <hr/>
        <div>
            <h6>Mentors</h6>
            <a href="${url("website_company_company", **vctxt.urlArgs)}" class="btn btn-primary">Add Mentor</a>
        </div>
        <hr/>
    </div>

    <div class="col col-lg-6">
        <div class="box-title highlight-target">
            <div id="target-create-product" class="highlight-anchor"></div>
            Product
        </div>
        %if not company.product_is_setup:
            <div class="box-header box-header-muted box-header-square"></div>
            <div class="mar-top-1">
            %if vctxt.canEditCompany:
                <a href="${url("website_company_product_create", **vctxt.urlArgs)}" class="btn btn-primary">Setup Your Product</a>
            %else:
                <h3>Not Setup yet</h3>
            %endif
            </div>
        %else:
            <div class="picture-header">
                <img src="${company.product_picture}"/>
            </div>
            <div class="mar-top-half">
                <a href="${url("website_company_product", **vctxt.urlArgs)}" class="overflow"><strong>${company.product_name}</strong></a>
                <div class="description">${html.nn(company.product_description) | html.trunc(50)}</div>
            </div>
        %endif
        <hr/>
        <div class="number-widget">
            <div class="thirds">
                <h6>Pledges</h6>
                <div class="value">${company.no_pledges}</div>
            </div><div class="two thirds">
                <h6>Customers</h6>
                <div class="picture-pile">
                    %for pledge in company.pledgees[:4]:
                        <div class="picture mini">
                            <img src="${pledge.picture}"/>
                        </div>
                    %endfor
                </div>
            </div>
        </div>
        <hr/>
    </div>
</div>
</%def>

<%def name="lowerContent()">
    <div class="row mar-top-2">
        <div class="col col-lg-12">
            <div class="box-title highlight-target">
                <div id="target-customise-needs" class="highlight-anchor"></div>
                Needs
            </div>
        </div>
    </div>
    <div class="row" id="project-round-need-dashboard" data-entity-id=${company.Round.token}>
        %for i, col in enumerate(company.groupedNeeds(3)):
            <div class="col col-lg-4 need-card-list">
                <div class="js-need-card-list">
                %for need in col:
                    ${self.buildNeed(need, company.Round.published)}
                %endfor
                </div>
                %if not i and vctxt.canEditCompany:
                    <a href="${url("website_round_need_create", **vctxt.urlArgs)}" class="need-card-inner add-card">
                        <img src="${STATIC_URL}img/addneed.png"/>
                        <h4>Create a new Need</h4>
                    </a>
                %endif
            </div>
        %endfor
    </div>
</%def>


<%def name="buildNeed(need, published)">
    <div class="need-card ${need.status}" data-entity-id="${need.token}">
        %if vctxt.canEditCompany:
            %if not need.customized:
                <a class="customize danger" href="${url("website_round_need_edit", need=need.slug, **vctxt.urlArgs)}"><span class="glyphicon glyphicon-exclamation-sign"></span> Customize Need</a>
            %else:
                <a class="customize success" href="${url("website_round_need", need=need.slug, **vctxt.urlArgs)}"><span class="glyphicon glyphicon-ok-sign"></span> Customized</a>
            %endif
        %endif
        <div class="need-card-inner">
            <div class="box-header box-header-muted box-card">
                %if not published and vctxt.canEditCompany:
                    <a class="remove" data-target=".need-card">Ã—</a>
                %endif
                <h5>
                    %if not need.customized:
                        <a href="${url("website_round_need_edit", need=need.slug, **vctxt.urlArgs)}">${need.name}</a>
                    %else:
                        <a href="${url("website_round_need", need=need.slug, **vctxt.urlArgs)}">${need.name}</a>
                    %endif
                </h5>

                <div class="description">
                    ${ html.coalesce(need.customText, need.summary) | html.trunc(300) }
                </div>
            </div>

            %if need.customized:
                <div class="need-body">
                    ${widgets.valuation(need)}
               </div>
               <hr class="boxed"/>
            %endif
            <div class="need-body">
                %for tag in need.tags:
                    <span class="label label-info spaced text-small">${tag}</span>
                %endfor
            </div>
            %if need.experts:
                <hr class="boxed"/>
                <div class="need-body">
                    <div class="experts">
                        <h6>Recomended Experts</h6>
                        <div class="picture-pile">
                        %for expert in need.experts[:4]:
                            <div class="picture small">
                                <img src="${expert.picture}" alt="${expert.name}"/>
                            </div>
                        %endfor
                        </div>
                    </div>
                </div>
            %endif
            %if need.services:
                <hr class="boxed"/>
                <div class="need-body">
                <div class="services">
                    <h6>Recomended Cloud Services</h6>
                    <div class="picture-pile">
                    %for service in need.services[:4]:
                        <div class="picture small">
                            <img src="${service.logo_url}" name="${service.name}"/>
                        </div>
                    %endfor
                    </div>
                </div>
                </div>
            %endif
        </div>
    </div>
</%def>




<%def name="wtfBox()">
    %if currentRound.published:
        <div class="company-dashboard box-shaded box-content">
            <h5>You have got</h5>
            <h1 class="super">${currentRound.getExpiryDays()}</h1>
            <h5>to fulfill your needs.</h5>
            <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</p>
            <a href="#" class="btn btn-primary btn-block">Spread the word</a>
        </div>
    %else:

        <%
            wf = currentRound.Workflow
            active = wf.getActiveStage()
        %>
        <div class="wtf-box company-dashboard">
            <h2 class="wtf-title">
                Steps
            </h2>
            <div class="wtf-content">
                Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.
            </div>
        </div>
        <ul class="list-unstyled">
            %for i, stage in enumerate(wf.sortedStages):
                <li>
                    <a class="workflow-link${' active' if active and active.name == stage.name else ''}${' done' if stage.completed else ''} wtf-${i+1}" href="#target-${stage.slug}">
                        <span class="position">${i+1}</span>${stage.display_name}
                    </a>
                </li>
            %endfor
        </ul>

        <div class="mar-top-2 highlight-target">
            <div id="target-publish" class="highlight-anchor"></div>
            <div id="target-sent-for-mentor-aprroval" class="highlight-anchor"></div>
            %if vctxt.canAskForApproval:
                %if wf.canAskForApproval():
                    <a href="${url("website_round_approve_ask", **vctxt.urlArgs)}" class="btn btn-primary btn-block btn-large">Get Approval</a>
                %elif wf.canPublish():
                    <a class="btn btn-primary btn-block btn-large disabled">Waiting For<br/>Approval</a>
                %else:
                    <a class="btn btn-primary btn-block btn-large disabled">Get Approval</a>
                %endif
            %elif vctxt.canApproveCompany:
                %if wf.canPublish():
                    <a href="${url("website_round_publish", **vctxt.urlArgs)}" class="btn btn-primary btn-block btn-large">Publish</a>
                %else:
                    <a class="btn btn-primary btn-block btn-large disabled">Publish</a>
                %endif
            %endif
        </div>
    %endif
</%def>


<%def name="post_scripts()">
<script>
    require(["views/company/dashboard"], function(View){
        var view =new View({el: $("#project-round-need-dashboard")});
    });
</script>
</%def>






<%doc>
    <div class="box-content min-height-5">
        <div class="row">
            <div class="col col-lg-3">
                ${widgets.product_logo(company)}
            </div>
            <div class="col col-lg-5 middle">
                <a href="${url("website_company_product", **vctxt.urlArgs)}" class="overflow"><strong>${company.product_name}</strong></a>
                <div class="description">${company.product_description | html.trunc(60) }</div>
            </div>
            <div class="col col-lg-4">
                <h5 class="upper no-margin text-muted">Pledges</h5>
                <div class="primary-number">${company.no_pledges}</div>
                <h5 class="upper no-margin text-muted mar-top-1">Customers</h5>
                <div class="picture-pile">
                    %for pledge in company.pledgees[:4]:
                        <div class="picture mini">
                            <img src="${pledge.picture}"/>
                        </div>
                    %endfor
                </div>
            </div>
        </div>
    </div>
</%doc>

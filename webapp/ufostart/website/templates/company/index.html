<%inherit file="../layout.html"/>
<%namespace file="../widgets.html" name="widgets"/>

<%def name="pageTitle()"><div class="page-header">${vctxt.company.name}</div></%def>

<%def name="content()">
    <div class="container">
        <div class="row mar-top-1">
            <div class="col col-lg-6">
                <div class="box-framed">
                    <div class="box-title">
                        Company
                    </div>
                    <div class="box-content min-height-7">
                        <div class="row">
                            <div class="col col-lg-2">
                                ${widgets.logo(company.logo_url)}
                            </div>
                            <div class="col col-lg-6">
                                <a href="${url("website_company_company", **vctxt.urlArgs)}"><strong>${company.display_name}</strong></a>
                                <div class="tagline">${company.display_description}</div>
                                <div class="text-muted text-small">
                                    ${company.display_tags}
                                </div>
                            </div>
                            <div class="col col-lg-4">
                                <h5 class="upper no-margin text-muted">
                                    Team members
                                </h5>
                                <div class="picture-pile">
                                %for member in company.Users[:8]:
                                    <div class="picture mini">
                                        <img src="${member.picture_url}"/>
                                        %if member.unconfirmed:
                                            <span title="unconfirmed" class="unconfirmed">unconfirmed</span>
                                        %endif
                                    </div>
                                %endfor
                                </div>
                                <a href="${url("website_company_company", **vctxt.urlArgs)}"><small>Invite more team members</small></a>
                            </div>
                        </div>

                        %if not company.is_setup:
                            <div class="disabled-overlay">
                                <div class="overlay-action">
                                    <a href="${url("website_company_company", **vctxt.urlArgs)}" class="btn btn-primary btn-large btn-block">Create Your Company</a>
                                </div>
                            </div>
                        %endif
                    </div>
                </div>
            </div>
            <div class="col col-lg-6">
                <div class="box-framed">
                    <div class="box-title">
                        Product
                    </div>
                    <div class="box-content min-height-7">
                        <div class="row">
                            <div class="col col-lg-3">
                                ${widgets.logo(company.product_picture)}
                            </div>
                            <div class="col col-lg-5">
                                <a href="${url("website_company_product", **vctxt.urlArgs)}"><strong>${company.product_name}</strong></a>
                                <div class="description">${company.product_description}</div>
                                <a href="${url("website_company_product", **vctxt.urlArgs)}"><small>More...</small></a>
                            </div>
                            <div class="col col-lg-4">
                                <h5 class="upper no-margin text-muted">Pledges</h5>
                                <div class="primary-number">${company.no_pledgees}</div>
                                <h5 class="upper no-margin text-muted mar-top-1">Pledgees</h5>
                                <div class="picture-pile">
                                    %for pledge in company.pledgees[:4]:
                                        <div class="picture mini">
                                            <img src="${pledge.picture}"/>
                                        </div>
                                    %endfor
                                </div>
                            </div>
                        </div>
                        %if not company.product_is_setup:
                            <div class="disabled-overlay">
                                <div class="overlay-action">
                                    <a href="${url("website_company_product", **vctxt.urlArgs)}" class="btn btn-primary btn-large btn-block">Create Your Product</a>
                                </div>
                            </div>
                        %endif
                    </div>
                </div>
            </div>
        </div>
        <div class="row mar-top-2">
            <div class="col col-lg-12">
                <div class="box-title">
                    Needs
                </div>
            </div>
        </div>
        <div class="row" id="project-round-need-dashboard" data-entity-id=${company.Round.token}>
            %for i, col in enumerate(company.groupedNeeds(4)):
                <div class="col col-lg-3 need-card-list">
                    <div class="js-need-card-list">
                    %for need in col:
                        ${self.buildNeed(need, company.Round.published)}
                    %endfor
                    </div>
                    %if not i:
                        <a href="${url("website_round_need_create", **vctxt.urlArgs)}" class="need-card add-card">
                            <img src="${STATIC_URL}img/addneed.png"/>
                            <h5>Create a new Need</h5>
                        </a>
                    %endif
                </div>
            %endfor
        </div>
        <div class="row">
            <div class="col col-lg-3 col-offset-9">
                <a href="#" class="btn btn-primary btn-humonguous btn-block"><span>Publish</span></a>
            </div>
        </div>
    </div>
</%def>


<%def name="buildNeed(need, published)">
    <div class="need-card" data-entity-id="${need.token}">
        %if not published:
            %if not need.customized:
                <a class="customize" href="${url("website_round_need", need=need.slug, **vctxt.urlArgs)}">Customize</a>
            %endif
            <a class="remove" data-target=".need-card">Ã—</a>
        %endif
        <h5><a href="${url("website_round_need", need=need.slug, **vctxt.urlArgs)}">${need.name}</a></h5>
        <div class="description">
            ${need.short_description}
        </div>
        <div class="valuation">
            <div class="primary-number pull-right">
                ${need.equity_mix}%
                <div class="legend">Equity</div>
            </div>
            <div class="primary-number">
                $${need.money_value}
                <div class="legend">Value</div>
            </div>
        </div>
        <div class="label-list">
            %for tag in need.tags:
                <span class="label label-info spaced text-small">${tag}</span>
            %endfor
        </div>
        %if need.Expert:
            <hr/>
            <div class="experts">
                <h5 class="no-margin upper text-muted">Recomended Experts</h5>
                <div class="picture-pile">
                    <div class="picture mini">
                        <img src="${need.Expert.picture}" alt="${need.Expert.name}"/>
                    </div>
                </div>
            </div>
        %endif
        %if need.Service:
            <hr/>
            <div class="services">
                <h5 class="no-margin upper text-muted">Recomended Cloud Services</h5>
                <div class="picture-pile">
                    <div class="picture medium">
                        <img src="${need.Service.logo_url}" name="${need.Service.name}"/>
                    </div>
                </div>
            </div>
        %endif
    </div>
</%def>

<%def name="post_scripts()">
<script>
    require(["views/company/dashboard"], function(View){
        var view =new View({el: $("#project-round-need-dashboard")});
    });
</script>
</%def>
<%inherit file="../layout.html"/>
<%namespace file="hnc:forms/templates/baseform.html" name="baseform"/>
<%namespace file="../widgets.html" name="widgets"/>

<%def name="header_buttons()">
    <div class="pull-right">
        Company: <a href="${url('website_company', **vctxt.urlArgs)}">${vctxt.company.name}</a>
    </div>
</%def>


<%def name="content()">
    <div class="container">
        <div class="row">
            <div class="col col-lg-12">
                <h1 class="site-slogan">${company.name}</h1>
            </div>
        </div>
        <div class="row">
            <div class="col col-lg-8">
                ${self.companyMainInfo(company)}
            </div>
            <div class="col col-lg-4">
                ${self.teamMembers(company.Users)}
            </div>
        </div>
    </div>
</%def>


<%def name="teamMembers(members)">
    <div class="box-framed expander expanded">
        <div class="box-title">
            %if vctxt.isTeamMember:
                <a class="btn btn-primary show-contracted" data-toggle-target=".expander" data-toggle-class="expanded">Invite More</a>
                <a class="btn btn-default show-expanded" data-toggle-target=".expander" data-toggle-class="expanded">Cancel</a>
            %endif
            Team Members
        </div>
        %if vctxt.isTeamMember:
            <div class="show-expanded box-dark">
                ${self.build_form(view.form, values.get(view.form.id), errors.get(view.form.id))}
            </div>
        %endif

        <div class="box-content">
            <div class="member-pile">
                %for member in members:
                    <div class="row mar-top-half">
                        <div class="col col-lg-3">
                            <div class="picture">
                                <img src="${member.picture_url}" width="100%"/>
                                %if member.unconfirmed:
                                    <span title="unconfirmed" class="unconfirmed">unconfirmed</span>
                                %endif
                            </div>
                        </div>
                        <div class="col col-lg-9">
                            %if member.token:
                                <a href="${url("website_user", slug = member.token)}"><strong>${member.name}</strong></a>
                            %else:
                                <strong>${member.name}</strong>
                            %endif
                            <div class="text-muted">${html.nn(member.position)}</div>
                        </div>
                    </div>
                %endfor
            </div>
        </div>
    </div>
</%def>


<%def name="companyMainInfo(company)">
    <div class="box-title">
        Company Information
    </div>
    <div class="row mar-top-1">
        <div class="col col-lg-3">
            ${widgets.logo(company.logo)}
        </div>
        <div class="col col-lg-9">
            <a href="${url('website_company', **vctxt.urlArgs)}"><strong>${company.name}</strong></a>
                <div class="mar-top-1">
                    ${html.nn(company.description)}
                </div>
        </div>
    </div>
</%def>




<%def name="build_form(form, values, errors)">
    <div class="box-content">
        <form class="${form.grid.form_classes}" id="${form.id}" method="POST">
            ${baseform.prelims(form)}
            %for field in view.form.fields:
                ${field.render(form.id, request, values, errors, view)|n}
            %endfor
            <button type="submit" class="btn btn-primary btn-block mar-top-1">Invite member</button>
        </form>
    </div>
</%def>

<%def name="post_scripts()">
    <script>
        require(["tools/ajax"], function(ajax){
            ajax.ifyForm({root: $("#${view.form.id}")}, {repeatables: true});
        });
    </script>
</%def>